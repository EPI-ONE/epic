#include "net_message.h"
#include "address_message.h"
#include "block.h"
#include "ping.h"
#include "pong.h"
#include "spdlog.h"
#include "sync_messages.h"
#include "version_message.h"

unique_message_t NetMessage::MessageFactory(uint32_t type, VStream& s) {
    try {
        switch (type) {
            case PING:
                return std::make_unique<Ping>(s);
            case PONG:
                return std::make_unique<Pong>(s);
            case VERSION_MSG:
                return std::make_unique<VersionMessage>(s);
            case VERSION_ACK:
                return std::make_unique<NetMessage>(VERSION_ACK);
            case GET_ADDR:
                return std::make_unique<NetMessage>(GET_ADDR);
            case ADDR:
                return std::make_unique<AddressMessage>(s);
            case TX:
                return std::make_unique<Transaction>(s);
            case BLOCK:
                return std::make_unique<Block>(s);
            case BUNDLE:
                return std::make_unique<Bundle>(s);
            case GET_INV:
                return std::make_unique<GetInv>(s);
            case INV:
                return std::make_unique<Inv>(s);
            case GET_DATA:
                return std::make_unique<GetData>(s);
            case NOT_FOUND:
                return std::make_unique<NotFound>(s);
            default:
                break;
        }
    } catch (std::exception& e) {
        spdlog::warn("message {} deserialize error {}", type, e.what());
    }

    return std::make_unique<NetMessage>(NONE);
}
